<?xml version="1.0" encoding="UTF-8"?>
<project name="release">
    <target name="deployment-update-release-number">
        <echo file="${basedir}/config/release" append="false">${env.BUILD_NUMBER}</echo>
    </target>

    <target name="deployment-prepare">
        <exec executable="mkdir" failonerror="true">
            <arg value="-p" />
            <arg value="${basedir}/../releases" />
        </exec>
    </target>

    <target name="deployment-archive">
        <exec executable="tar" failonerror="true">
            <arg value="--exclude=.git" />
            <arg value="-zcf" />
            <arg value="${basedir}/../release/release.tar.gz" />
            <arg value="${basedir}/../code" />
        </exec>
    </target>

    <target name="deployment-release" depends="
        deployment-prepare,
        deployment-update-release-number,
        tools-composer-install,
        tools-public-vendor,
        tools-generate-static
    ">
        <antcall target="deployment-archive" />

        <echo>${env.BUILD_NUMBER}</echo>
    </target>
</project>
