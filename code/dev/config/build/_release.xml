<?xml version="1.0" encoding="UTF-8"?>
<project name="release" basedir="${basedir}/../../..">
    <target name="release-update-number">
        <echo file="${basedir}/config/release" append="false">${release}</echo>
    </target>

    <target name="release-archive">
        <exec executable="mkdir" failonerror="true">
            <arg value="-p" />
            <arg value="-m" />
            <arg value="0777" />
            <arg value="${basedir}/../../releases" />
        </exec>

        <exec executable="tar" failonerror="true">
            <arg value="--exclude=./.git" />
            <arg value="--exclude=./.idea" />
            <arg value="-zcf" />
            <arg value="${basedir}/../../releases/release-${release}.tar.gz" />
            <arg value="." />
        </exec>

        <exec executable="chmod" failonerror="true">
            <arg value="0777" />
            <arg value="${basedir}/../../releases/release-${release}.tar.gz" />
        </exec>
    </target>

    <target name="release-upload">
        <exec executable="mkdir" failonerror="true">
            <arg value="-p" />
            <arg value="/root/.ssh" />
        </exec>

        <exec executable="cp" failonerror="true">
            <arg value="/root/.ssh-tmp/id_rsa.pub" />
            <arg value="/root/.ssh/id_rsa.pub" />
        </exec>

        <exec executable="cp" failonerror="true">
            <arg value="/root/.ssh-tmp/id_rsa" />
            <arg value="/root/.ssh/id_rsa" />
        </exec>

        <exec executable="scp" failonerror="true">
            <arg value="/var/www/releases/release-${release}.tar.gz" />
            <arg value="mike@10.200.218.71:/home/mike/git/test/releases/release-${release}.tar.gz" />
        </exec>
    </target>

    <target name="release-deploy" depends="release-update-number, release-archive, release-upload">
    </target>

    <target name="release-make" depends="release-update-number, tools-composer-install, test-phpunit-reload-fixtures, release-archive">
    </target>
</project>
