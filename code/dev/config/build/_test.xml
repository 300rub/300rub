<?xml version="1.0" encoding="UTF-8"?>
<project name="test" basedir="${basedir}/../../..">
    <target name="test-import-dev-fixtures">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ImportDevFixturesCommand' />
            <arg value='test' />
        </exec>
    </target>

    <target name="test-export-db">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ExportTestCommand' />
        </exec>
    </target>

    <target name="test-import-db">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ImportTestCommand' />
        </exec>
    </target>

    <target name="test-recreate-test-database">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/RecreateTestDatabaseCommand' />
        </exec>
    </target>

    <target name="test-phpunit" depends="tools-flush-memcached, test-import-db">
        <exec executable="php" failonerror="true">
            <arg value='vendor/phpunit/phpunit/phpunit' />
            <arg value='--bootstrap=tests/unit/bootstrap.php' />
            <arg value='${path}' />
        </exec>

        <antcall target="tools-flush-memcached" />
    </target>

    <target name="test-phpunit-reload-fixtures" depends="tools-flush-memcached, test-recreate-test-database, db-migrate, test-import-dev-fixtures, test-export-db">
        <exec executable="php" failonerror="true">
            <arg value='vendor/phpunit/phpunit/phpunit' />
            <arg value='--bootstrap=tests/unit/bootstrap.php' />
            <arg value='${path}' />
        </exec>

        <antcall target="tools-flush-memcached" />
    </target>

    <target name="test-paratest">
        <exec executable="php" failonerror="true">
            <arg value='vendor/brianium/paratest/bin/paratest' />
            <arg value='--bootstrap=tests//selenium/bootstrap.php' />
            <arg value='-p 1' />
            <arg value='-f' />
            <arg value='tests/selenium' />
        </exec>
    </target>
</project>
