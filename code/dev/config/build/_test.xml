<?xml version="1.0" encoding="UTF-8"?>
<project name="test">
    <target name="test-import-phpunit-fixtures">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ImportFixturesCommand' />
            <arg value='phpunit' />
        </exec>
    </target>

    <target name="test-export-db">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ExportTestCommand' />
        </exec>
    </target>

    <target name="test-import-db">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/ImportTestCommand' />
        </exec>
    </target>

    <target name="test-recreate-test-database">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/RecreateTestDatabaseCommand' />
        </exec>
    </target>

    <target name="test-phpunit" depends="tools-flush-memcached, test-import-db">
        <property name="path" value="tests/phpunit"/>

        <exec executable="php" failonerror="true">
            <arg value='vendor/phpunit/phpunit/phpunit' />
            <arg value='--bootstrap=tests/phpunit/bootstrap.php' />
            <arg value='${path}' />
        </exec>

        <antcall target="tools-flush-memcached" />
    </target>

    <target name="test-phpunit-reload-fixtures" depends="test-upload-prepare, tools-flush-memcached, test-recreate-test-database, test-migrate, test-import-phpunit-fixtures, test-export-db">
        <property name="path" value="tests/phpunit"/>

        <exec executable="php" failonerror="true">
            <arg value='vendor/phpunit/phpunit/phpunit' />
            <arg value='--bootstrap=tests/phpunit/bootstrap.php' />
            <arg value='${path}' />
        </exec>

        <antcall target="tools-flush-memcached" />
    </target>

    <target name="test-paratest" depends="test-upload-prepare">
        <exec executable="php" failonerror="true">
            <arg value='vendor/brianium/paratest/bin/paratest' />
            <arg value='--bootstrap=tests//selenium/bootstrap.php' />
            <arg value='-p 1' />
            <arg value='-f' />
            <arg value='tests/selenium' />
        </exec>
    </target>

    <target name="test-upload-prepare">
        <delete dir="public/upload/phpunit" />
        <mkdir dir="public/upload/phpunit" />
        <exec executable="chmod" failonerror="true">
            <arg line="-R 0777 public/upload/phpunit" />
        </exec>
    </target>

    <target name="test-migrate">
        <exec executable="php" failonerror="true">
            <arg value='commands/run' />
            <arg value='db/MigrateCommand' />
            <arg value='phpunit' />
        </exec>
    </target>
</project>
